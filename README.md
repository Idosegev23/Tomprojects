# מערכת ניהול פרויקטים לתום הרוש

מערכת ניהול פרויקטים של נדל"ן המיועדת למשרד הראשי, המאפשרת לראות, להוסיף ולערוך פרויקטים ומשימות (כולל תתי‑משימות) בצורה פשוטה.

## תכונות עיקריות

- **ניהול פרויקטים** - יצירה, עריכה וצפייה בפרויקטי נדל"ן
- **ניהול משימות** - יצירה, עריכה וצפייה במשימות ותתי-משימות
- **תצוגות מרובות** - לוח קנבן, עץ היררכי, גאנט ורשימה
- **תבניות** - יצירת פרויקטים מבוססי תבניות עם משימות מוגדרות מראש
- **תמיכה מלאה במובייל** - ממשק רספונסיבי המותאם לכל גודל מסך

## טכנולוגיות

- **Frontend**: Next.js, React, Tailwind CSS, Chakra UI
- **Backend**: Supabase (PostgreSQL)
- **ניהול מצב**: React Query
- **גרירה ושחרור**: react-beautiful-dnd
- **לוח זמנים**: FullCalendar
- **רספונסיביות**: Chakra UI Responsive API, CSS Media Queries

## התקנה והפעלה

### דרישות מקדימות

- Node.js (גרסה 16 ומעלה)
- Yarn או npm
- חשבון Supabase

### התקנה

1. שכפל את המאגר:
```bash
git clone <repository-url>
cd tom-project
```

2. התקן את התלויות:
```bash
yarn install
# או
npm install
```

3. הגדר את משתני הסביבה:
   - צור קובץ `.env.local` בתיקייה הראשית
   - הוסף את המשתנים הבאים:
   ```
   NEXT_PUBLIC_SUPABASE_URL=https://orgkbmxecoegyjojoqmh.supabase.co
   NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9yZ2tibXhlY29lZ3lqb2pvcW1oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzg4NjMyODYsImV4cCI6MjA1NDQzOTI4Nn0.jK13G36VU7eLVQsxsXLhlYLKafISrh9j8QIWIQH7TVs
   ```

4. הפעל את השרת:
```bash
yarn dev
# או
npm run dev
```

5. פתח את הדפדפן בכתובת [http://localhost:3000](http://localhost:3000)

## תמיכה במובייל ורספונסיביות

המערכת תומכת באופן מלא במכשירים ניידים וטאבלטים בכל הגדלים. התכונות העיקריות כוללות:

- **תפריט צד מותאם** - תפריט צד שמתחלף לתפריט נשלף במסכים קטנים
- **פריסה דינמית** - התאמה אוטומטית של פריסת הדפים לגודל המסך
- **טבלאות רספונסיביות** - טבלאות שמתאימות את עצמן למסכים קטנים
- **כרטיסיות מותאמות** - כרטיסיות פרויקטים ומשימות שמשנות את הפריסה שלהן במובייל
- **טפסים מותאמים** - טפסי יצירה ועריכה שמתאימים את עצמם למסכים קטנים

### נקודות שבירה (Breakpoints)

המערכת משתמשת בנקודות השבירה הבאות:
- **sm**: 480px ומעלה
- **md**: 768px ומעלה
- **lg**: 992px ומעלה
- **xl**: 1280px ומעלה
- **2xl**: 1536px ומעלה

## כלים ותסריטים

### עדכון סכמת מסד הנתונים

הפרויקט כולל סקריפט אוטומטי לעדכון ותיעוד סכמת מסד הנתונים:

```bash
./scripts/update_schema.sh
```

הסקריפט מייצר קובץ `database_schema.md` עם תיעוד מלא של מבנה מסד הנתונים, כולל:
- רשימת טבלאות
- עמודות וסוגי נתונים
- מפתחות ראשיים וזרים
- אילוצים

**הערה**: יש להריץ את הסקריפט בכל פעם שיש שינוי בסכמת מסד הנתונים.

#### עדכון אוטומטי

הפרויקט כולל גם git hook שמעדכן את סכמת מסד הנתונים באופן אוטומטי בכל פעם שיש commit עם שינויים בקבצי SQL או בקבצים הקשורים למסד הנתונים. ה-hook נמצא בנתיב `.git/hooks/pre-commit`.

אם ברצונך להפעיל את ה-hook באופן ידני, הרץ:

```bash
.git/hooks/pre-commit
```

### פונקציות SQL

הפרויקט כולל גם קובץ SQL עם פונקציות RPC שיכולות לשמש לקבלת מידע על הסכמה:

```bash
# התקנת פונקציות ה-RPC בסופהבייס (דורש Docker)
supabase db execute -f scripts/create_rpc_functions.sql
```

## מבנה הפרויקט

- `src/pages/` - דפי האפליקציה
- `src/components/` - קומפוננטות React
- `src/services/` - שירותים לתקשורת עם Supabase
- `src/types/` - טיפוסי TypeScript
- `src/utils/` - פונקציות עזר
- `scripts/` - סקריפטים שימושיים
- `supabase/` - הגדרות Supabase

## תיעוד נוסף

- [מסמך אפיון](build_tracking.md) - אפיון מפורט של המערכת
- [סכמת מסד הנתונים](database_schema.md) - תיעוד מבנה מסד הנתונים

## כללי עבודה

ראה [כללי עבודה](rule.mdc) לפרטים על כללי העבודה בפרויקט.

## רישיון

כל הזכויות שמורות © תום הרוש 

## הוראות התקנה

1. התקן את הספריות הנדרשות:
```bash
npm install
```

2. הגדר את משתני הסביבה בקובץ `.env.local`:
```
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
```

3. הפעל את השרת המקומי:
```bash
npm run dev
```

## הגדרת פונקציות SQL בשרת Supabase

כדי לאפשר יצירת טבלאות ספציפיות לפרויקטים, יש להעלות את הפונקציות SQL הבאות לשרת Supabase:

1. התחבר לפאנל הניהול של Supabase
2. עבור ל-SQL Editor
3. לחץ על "New Query"
4. העתק את תוכן הקובץ `sql/project_tables.sql` לעורך
5. לחץ על "Run" כדי ליצור את הפונקציות

הפונקציות שיווצרו:
- `check_table_exists` - בדיקה אם טבלה קיימת
- `create_project_table` - יצירת טבלת משימות ספציפית לפרויקט
- `drop_project_table` - מחיקת טבלת משימות ספציפית לפרויקט
- `copy_task_to_project_table` - העתקת משימה לטבלה הספציפית של הפרויקט
- `update_task_in_project_table` - עדכון משימה בטבלה הספציפית של הפרויקט
- `delete_task_from_project_table` - מחיקת משימה מהטבלה הספציפית של הפרויקט
- `get_project_tasks` - קבלת כל המשימות מהטבלה הספציפית של הפרויקט
- `sync_project_tasks` - סנכרון כל המשימות של פרויקט מהטבלה הראשית לטבלה הספציפית

בנוסף, יווצרו טריגרים שיפעילו את הפונקציות באופן אוטומטי בעת יצירת או מחיקת פרויקט.

## שימוש בטבלאות ספציפיות לפרויקטים

לאחר הגדרת הפונקציות SQL, המערכת תיצור באופן אוטומטי טבלה ספציפית לכל פרויקט חדש. הטבלה תכיל את כל המשימות של הפרויקט ותאפשר ביצועים טובים יותר בפרויקטים גדולים.

ניתן לסנכרן את המשימות בין הטבלה הראשית לטבלה הספציפית באמצעות כפתור "סנכרון משימות" בדף הפרויקט.

# פתרון לבעיות הרשאות וטבלאות מותאמות פרויקט

מדריך זה מסביר כיצד להתקין ולהפעיל את הפתרון לבעיות ההרשאות והיצירה האוטומטית של טבלאות ייחודיות לפרויקטים במערכת. הפתרון כולל מנגנון אוטומטי ליצירת טבלאות פרויקט בעת יצירת פרויקט חדש והענקת הרשאות מתאימות.

## תקציר הפתרון

הפתרון מבוסס על הוספת מיגרציה שיוצרת:
1. פונקציות עזר לבדיקת קיום טבלאות
2. פונקציה ליצירת טבלאות ייחודיות לפרויקט
3. טריגר שמופעל אוטומטית בעת יצירת פרויקט חדש
4. פונקציות RPC לאתחול, שליפת נתונים ועבודה עם טבלאות הפרויקט
5. הענקת הרשאות גישה מתאימות לכל המשתמשים

## דרישות מקדימות

1. גישה לממשק SQL של Supabase
2. גישת מנהל (Service Role) ל-API של Supabase
3. Node.js מותקן (גרסה 14 ומעלה)

## שלבי היישום

### אפשרות 1: הרצה אוטומטית של כל התיקונים

זוהי האפשרות המומלצת והפשוטה ביותר.

1. ודא שקובץ `.env.local` כולל את המשתנים הבאים:
   ```
   NEXT_PUBLIC_SUPABASE_URL=https://your-project-url.supabase.co
   SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
   ```

2. הרץ את סקריפט התיקונים האוטומטי:
   ```bash
   node scripts/fix_all_issues.mjs
   ```

3. המתן לסיום הריצה של כל השלבים. הסקריפט יבצע:
   - תיקון הרשאות לטבלת stages
   - תיקון מבנה טבלת stages
   - התקנת פונקציית אתחול טבלאות פרויקט
   - התקנת הטריגר האוטומטי ליצירת טבלאות
   - בדיקה ויצירת פרויקט לדוגמה (במידת הצורך)
   - יצירת הטבלאות הייחודיות לפרויקט
   - אתחול הטבלאות עם נתונים ראשוניים

4. רענן את הדפדפן באפליקציה שלך וודא שהבעיות נפתרו

### אפשרות 2: הרצה ידנית דרך ממשק SQL של Supabase

אם אינך יכול להשתמש בסקריפט האוטומטי, באפשרותך להריץ את הקבצים באופן ידני:

1. פתח את ממשק SQL ב-Supabase
2. הרץ את הקבצים הבאים לפי הסדר:
   - `scripts/fix_stages_permissions.sql`
   - `scripts/fix_stages_table.sql`
   - `scripts/init_project_function.sql`
   - `supabase/migrations/20250410000000_create_project_triggers.sql`

3. הרץ את הפקודה הבאה כדי ליצור טבלאות עבור פרויקט ספציפי (החלף את מזהה הפרויקט):
   ```sql
   SELECT create_project_tables('YOUR-PROJECT-UUID-HERE');
   ```

4. הרץ את הפקודה הבאה כדי לאתחל את טבלאות הפרויקט עם נתונים התחלתיים:
   ```sql
   SELECT init_project_tables_and_data('YOUR-PROJECT-UUID-HERE', true, true);
   ```

## כיצד הפתרון עובד

### טריגר אוטומטי

הפתרון מבוסס על טריגר שמופעל אוטומטית בכל פעם שנוצר פרויקט חדש בטבלת `projects`. הטריגר קורא לפונקציה שיוצרת את הטבלאות הייחודיות לפרויקט:

```sql
CREATE TRIGGER project_after_insert
AFTER INSERT ON projects
FOR EACH ROW
EXECUTE FUNCTION project_after_insert_trigger();
```

### יצירת טבלאות ייחודיות

הפונקציה `create_project_tables` יוצרת שתי טבלאות לכל פרויקט:
- טבלת משימות: `project_{PROJECT_ID}_tasks`
- טבלת שלבים: `project_{PROJECT_ID}_stages`

כל טבלה מקבלת הרשאות מתאימות לכל סוגי המשתמשים ו-RLS מבוטל.

### אתחול נתונים ראשוניים

הפונקציה `init_project_tables_and_data` מאתחלת את הטבלאות עם:
- שלבים התחלתיים (10 שלבים סטנדרטיים)
- משימות התחלתיות (10 משימות לדוגמה)

### פונקציות RPC לגישה לנתונים

נוספו שתי פונקציות חשובות לשימוש בקוד האפליקציה:
- `get_project_tasks` - להחזרת כל המשימות של פרויקט ספציפי
- `get_tasks_tree` - להחזרת עץ משימות היררכי של פרויקט

## איתור תקלות

אם עדיין נתקלת בבעיות אחרי הרצת הפתרון:

1. בדוק את הרשאות הגישה לטבלאות הפרויקט:
   ```sql
   GRANT ALL PRIVILEGES ON TABLE project_{PROJECT_ID}_tasks TO anon, authenticated, service_role;
   GRANT ALL PRIVILEGES ON TABLE project_{PROJECT_ID}_stages TO anon, authenticated, service_role;
   ```

2. ודא שה-RLS מבוטל:
   ```sql
   ALTER TABLE project_{PROJECT_ID}_tasks DISABLE ROW LEVEL SECURITY;
   ALTER TABLE project_{PROJECT_ID}_stages DISABLE ROW LEVEL SECURITY;
   ```

3. בדוק שהפרויקט קיים בטבלת `projects`:
   ```sql
   SELECT * FROM projects WHERE id = '{PROJECT_ID}';
   ```

## שדרוגים עתידיים

הפתרון הנוכחי מבוסס על מנגנון אוטומטי, אך ניתן לשדרג אותו בעתיד:

1. הוספת מנגנון לשכפול תבניות פרויקט שלמות
2. מערכת ניהול הרשאות מתקדמת יותר לטבלאות הפרויקט
3. אופטימיזציה של שאילתות בפרויקטים גדולים

## תמיכה

אם נתקלת בבעיות נוספות או יש לך שאלות, אנא צור קשר בכתובת הדוא"ל [תמיכה].

# העתקת משימות נבחרות לפרויקטים חדשים

מסמך זה מסביר כיצד לממש תהליך שבו רק משימות שנבחרו על ידי המשתמש (באמצעות צ'קבוקסים) יועתקו לפרויקט חדש.

## רקע

המערכת מציעה תהליך אוטומטי שבו נוצרות טבלאות ייחודיות לכל פרויקט בעת יצירתו. עד כה, תהליך זה העתיק את כל המשימות או ייצר משימות ברירת מחדל. הפתרון שלנו מאפשר למשתמש לבחור אילו משימות לשייך, תוך שמירה על הפעלת טריגרים ואתחול טבלאות כרגיל.

## מה הפתרון מבצע?

1. **עדכון פונקציות קיימות** - מעדכן את הפונקציה `init_project_tables_and_data` כדי לטפל נכון ברשימת משימות נבחרות
2. **שינוי התנהגות הטריגר** - מעדכן את הטריגר `project_after_insert_trigger` כך שייצור רק טבלאות ושלבים, ללא משימות
3. **הוספת פונקציה חדשה** - מוסיף פונקציה `init_project_with_selected_tasks` שמקלה על העתקת משימות נבחרות לפרויקט קיים

## איך משדרגים את המערכת?

### שיטה 1: שימוש ישיר ב-SQL Editor של סופאבייס

1. התחבר לסופאבייס ופתח את ה-SQL Editor
2. העתק את תוכן הקובץ `supabase_migration.sql` לעורך
3. לחץ על Run כדי להחיל את השינויים
4. וודא שאין שגיאות בתוצאות הריצה

### שיטה 2: שימוש בכלי supabase CLI (עבור מפתחים)

1. צור קובץ migrations חדש:
```bash
mkdir -p supabase/migrations/$(date +%Y%m%d%H%M%S)_project_tasks_selection
cp supabase_migration.sql supabase/migrations/$(date +%Y%m%d%H%M%S)_project_tasks_selection/up.sql
```

2. צור קובץ down.sql פשוט להסרת הפונקציות (אופציונלי):
```sql
DROP FUNCTION IF EXISTS init_project_with_selected_tasks(uuid, uuid[]);
DROP TRIGGER IF EXISTS project_after_insert_trigger ON projects;
DROP FUNCTION IF EXISTS project_after_insert_trigger();
DROP FUNCTION IF EXISTS init_project_tables_and_data(uuid, boolean, boolean, uuid[]);
```

3. העלה את השינויים לסופאבייס:
```bash
supabase db push
```

## כיצד להשתמש בפתרון?

### SQL שימוש ישיר ב

```sql
-- 1. יצירת פרויקט חדש
INSERT INTO projects (name, description, status)
VALUES ('פרויקט חדש', 'תיאור הפרויקט', 'planning')
RETURNING id; -- נשמור את המזהה שמוחזר

-- 2. העתקת המשימות הנבחרות
SELECT init_project_with_selected_tasks(
  '3fa85f64-5717-4562-b3fc-2c963f66afa6', -- מזהה הפרויקט שנוצר בשלב 1
  ARRAY['11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222'] -- המשימות הנבחרות
);
```

### אינטגרציה עם Supabase JavaScript Library

ראה את הקובץ `supabase_integration.js` לדוגמה מלאה של אינטגרציה. הנה תקציר הפעולות המרכזיות:

```javascript
// 1. יצירת פרויקט חדש
const { data: project, error: projectError } = await supabase
  .from('projects')
  .insert([{
    name: 'פרויקט חדש',
    description: 'תיאור הפרויקט',
    status: 'planning'
  }])
  .select()
  .single();

// 2. העתקת המשימות הנבחרות
const { error } = await supabase.rpc('init_project_with_selected_tasks', {
  project_id_param: project.id,
  selected_task_ids: ['11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222']
});
```

### שימוש במסגרת דף React

1. ממשק למשתמש לבחירת משימות:
   - הצג רשימת צ'קבוקסים של משימות קיימות
   - שמור את ה-IDs של המשימות שנבחרו במערך
   
2. בעת יצירת הפרויקט:
   - צור את הפרויקט בטבלת `projects`
   - קרא לפונקציה `init_project_with_selected_tasks` עם מזהה הפרויקט החדש ומערך המשימות שנבחרו

## טיפול בשגיאות

הפתרון כולל טיפול בשגיאות:

1. **בדיקת קיום פרויקט** - הפונקציה תחזיר שגיאת אם הפרויקט לא קיים
2. **טיפול בבעיות העתקה** - שגיאות בהעתקת משימות ספציפיות נלכדות ולא מפסיקות את התהליך
3. **לוגים והודעות** - הודעות מפורטות נרשמות לתיעוד מה קרה

## הערות נוספות

- הפתרון פועל רק על פרויקטים שייווצרו מעכשיו ואילך
- אין צורך לבצע שינויים בפרויקטים קיימים
- תוכל לקרוא לפונקציה `init_project_with_selected_tasks` גם עבור פרויקטים קיימים כדי להוסיף להם משימות נבחרות

## תמיכה וסיוע

אם נתקלת בבעיות:
1. בדוק את ה-logs במסוף ה-SQL של סופאבייס
2. וודא שכל הפונקציות הותקנו כראוי
3. בדוק אם יש סתירות עם פונקציות או טריגרים קיימים 

# העתקת משימות נבחרות ושלבים לפרויקטים חדשים

פתרון זה מאפשר למשתמש לבחור אילו משימות יועתקו לפרויקט חדש, ובו-זמנית מבטיח שרק השלבים הרלוונטיים למשימות אלה יועתקו גם הם.

## רקע

בעת יצירת פרויקט חדש, לעיתים קרובות רוצים להתחיל עם משימות ושלבים מוגדרים מראש. בעבר, היינו יכולים:
1. ליצור פרויקט ריק לחלוטין (ללא משימות) - מה שדרש הגדרה ידנית של הכל
2. להעתיק את כל המשימות - מה שיכול היה ליצור בלגן עם משימות לא רלוונטיות

הפתרון החדש מאפשר לנו לבחור בדיוק אילו משימות אנחנו רוצים, ורק השלבים הרלוונטיים למשימות אלה יועתקו.

## מה הפתרון עושה

1. **בוחרים משימות** - משתמש מסמן צ'קבוקסים לבחירת משימות ספציפיות
2. **יוצרים פרויקט** - נוצר פרויקט חדש עם טבלאות ייחודיות לאותו פרויקט
3. **מעתיקים משימות נבחרות** - רק המשימות שנבחרו מועתקות לטבלת המשימות של הפרויקט
4. **מאתרים שלבים רלוונטיים** - הפתרון מזהה אוטומטית אילו שלבים קשורים למשימות שנבחרו
5. **מעתיקים שלבים רלוונטיים** - רק השלבים הרלוונטיים מועתקים לטבלת השלבים של הפרויקט

## הקבצים בפתרון

הפתרון כולל שני קבצים עיקריים:

1. **`supabase_solution.sql`** - קובץ SQL שמכיל את כל הפונקציות והטריגרים הדרושים במסד הנתונים.
2. **`react_integration.jsx`** - קובץ React לדוגמה שמראה איך לשלב את הפתרון בממשק המשתמש.

## איך להתקין

### 1. התקנת הפונקציות בסופאבייס

1. התחבר לממשק ניהול סופאבייס
2. לחץ על SQL Editor
3. העלה את קובץ `supabase_solution.sql` או העתק והדבק את תוכנו
4. לחץ על "Execute" (או RUN)
5. ודא שאין שגיאות בתוצאות

### 2. שילוב בקוד הפרונט-אנד

דוגמה לשילוב הפתרון בקוד React שלך נמצאת בקובץ `react_integration.jsx`. הקובץ מראה איך:

1. לטעון את כל המשימות הקיימות
2. להציג אותן עם צ'קבוקסים שמאפשרים למשתמש לבחור
3. ליצור פרויקט חדש עם המשימות שנבחרו

## איך זה עובד טכנית

הפתרון משתמש במספר פונקציות ב-PostgreSQL שפועלות בסדר הבא:

1. **יוצרים פרויקט ב-UI** - המשתמש בוחר משימות וממלא פרטי פרויקט
2. **נוצרת רשומת פרויקט ב-DB** - מופעל טריגר `project_after_insert_trigger` שיוצר את הטבלאות הייחודיות (בלי משימות ברירת מחדל)
3. **קריאה ל`init_project_with_selected_tasks`** - מעבירים מזהה פרויקט ומערך מזהי משימות
4. **הפונקציה קוראת ל`init_project_tables_and_data`** - שמעתיקה את המשימות הנבחרות
5. **קריאה ל`build_stages_from_selected_tasks`** - מזהה ומעתיקה רק את השלבים הרלוונטיים למשימות שנבחרו

### הפונקציה `build_stages_from_selected_tasks`

זוהי הפונקציה הייחודית לפתרון, והיא:
1. מזהה את כל השלבים (שדה `stage_id`) המשויכים למשימות שכבר הועתקו לפרויקט
2. שולפת את נתוני השלבים האלה מטבלת השלבים הכללית
3. מכניסה רק את השלבים האלה לטבלת השלבים הספציפית של הפרויקט
4. אם אין שלבים, יוצרת שלב ברירת מחדל אחד
5. מעדכנת משימות ללא שלב לשימוש בשלב הראשון בטבלה

## יתרונות הפתרון

1. **התאמה מדויקת** - הפרויקט מכיל רק את המשימות והשלבים שרלוונטיים
2. **שליטה למשתמש** - המשתמש בוחר בדיוק מה להעתיק
3. **שימור יחסים** - הקשרים בין משימות לשלבים נשמרים
4. **מניעת כפילויות** - נמנעת יצירה של שלבים מיותרים
5. **חוויית משתמש טובה** - תהליך פשוט ואינטואיטיבי עם משוב מיידי

## דוגמה לשימוש בקוד

### צד השרת (SQL)

```sql
-- 1. יצירת פרויקט חדש
INSERT INTO projects (name, description, status)
VALUES ('פרויקט חדש', 'תיאור הפרויקט', 'planning')
RETURNING id;
-- לדוגמה נקבל: 123e4567-e89b-12d3-a456-426614174000

-- 2. העתקת משימות נבחרות ושלבים
SELECT init_project_with_selected_tasks(
  '123e4567-e89b-12d3-a456-426614174000',
  ARRAY['11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222']
);
```

### צד הלקוח (JavaScript)

```javascript
// יצירת פרויקט עם משימות נבחרות
async function createProject() {
  // 1. יצירת הפרויקט
  const { data: project } = await supabase
    .from('projects')
    .insert([{
      name: 'פרויקט חדש',
      description: 'תיאור הפרויקט',
      status: 'planning'
    }])
    .select()
    .single();
  
  // 2. העתקת המשימות הנבחרות
  const { data } = await supabase.rpc('init_project_with_selected_tasks', {
    project_id_param: project.id,
    selected_task_ids: ['11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222']
  });
  
  console.log('תוצאה:', data);
}
```

## פתרון בעיות נפוצות

**שאלה**: משימה מסוימת לא מועתקת לפרויקט.
**תשובה**: ודא שה-ID של המשימה תקין וקיים בטבלת המשימות הראשית.

**שאלה**: השלבים לא מועתקים כפי שציפיתי.
**תשובה**: בדוק שלמשימות שבחרת יש שיוך לשלבים (שדה `stage_id` לא ריק).

**שאלה**: קיבלתי שגיאה "פרויקט לא קיים".
**תשובה**: ודא שאתה קורא לפונקציה `init_project_with_selected_tasks` עם מזהה פרויקט תקין.

**שאלה**: קיבלתי שגיאה "לא נבחרו משימות".
**תשובה**: הפונקציה דורשת לפחות משימה אחת נבחרת. ודא שמערך המשימות אינו ריק.

## עדכונים עתידיים אפשריים

1. תמיכה בהעתקת תתי-משימות (משימות מקוננות)
2. אפשרות לבחירת שלבים באופן ידני בנוסף למשימות
3. שיפור הביצועים עבור מספר גדול של משימות
4. יכולת לשנות את הקישורים בין משימות לשלבים בזמן ההעתקה

## מידע נוסף

הפתרון נבנה כדי לתמוך באופן מלא ב:
- התאמה אישית של פרויקטים
- תמיכה בפרויקטים בכל גודל
- ביצועים טובים גם עם הרבה נתונים
- אבטחה מלאה עם הרשאות מתאימות

לשאלות נוספות, אנא צור קשר עם צוות הפיתוח.

## אתחול משימות בפרויקט קיים

אם נתקלת בבעיה שבה פרויקט נוצר אבל המשימות שבחרת לא הופיעו בטבלת המשימות של הפרויקט, ניתן להשתמש בכלי האתחול שיצרנו:

```
node scripts/init_tasks_for_existing_project.mjs
```

הכלי יבקש ממך להזין את מזהה הפרויקט (UUID) ויציג רשימה של משימות זמינות לבחירה. לאחר בחירת המשימות הרצויות, הכלי יאתחל את טבלאות הפרויקט ויוסיף את המשימות הנבחרות.

הכלי שימושי במיוחד במקרים הבאים:
1. כאשר יצירת הפרויקט הצליחה אבל אתחול המשימות נכשל
2. כאשר רוצים להוסיף משימות חדשות לפרויקט קיים
3. כאשר רוצים להחליף את המשימות בפרויקט קיים

## עדכונים עתידיים אפשריים

1. תמיכה בהעתקת תתי-משימות (משימות מקוננות)
2. אפשרות לבחירת שלבים באופן ידני בנוסף למשימות
3. שיפור הביצועים עבור מספר גדול של משימות
4. יכולת לשנות את הקישורים בין משימות לשלבים בזמן ההעתקה

## מידע נוסף

הפתרון נבנה כדי לתמוך באופן מלא ב:
- התאמה אישית של פרויקטים
- תמיכה בפרויקטים בכל גודל
- ביצועים טובים גם עם הרבה נתונים
- אבטחה מלאה עם הרשאות מתאימות

לשאלות נוספות, אנא צור קשר עם צוות הפיתוח. 