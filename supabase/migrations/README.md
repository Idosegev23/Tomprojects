# טבלאות פרויקט ואתחול נתונים

## מבנה הפתרון

הפתרון כולל את הקבצים הבאים:

1. **20230101000000_init_project_functions.sql** - פונקציות לאתחול טבלאות ונתוני פרויקט
2. **20230101000001_project_trigger.sql** - טריגר שיקרא לפונקציה אתחול בעת יצירת פרויקט

## הפעלת המיגרציות

להפעלת המיגרציות על בסיס הנתונים, השתמש בפקודה:

```bash
supabase db push
```

## מה הפתרון מבצע?

1. **יצירת טבלאות ייעודיות לפרויקט**:
   - טבלת משימות לפרויקט (`project_{id}_tasks`)
   - טבלת שלבים לפרויקט (`project_{id}_stages`)

2. **העתקת משימות**:
   - העתקת משימות נבחרות מטבלת `tasks` המרכזית לטבלת המשימות של הפרויקט
   - אם לא נבחרו משימות, יצירת משימות ברירת מחדל

3. **יצירת שלבים**:
   - בניית שלבים המבוססים על המשימות שנבחרו
   - אם המשימות כבר שייכות לשלבים, העתקת השלבים מטבלת `stages` המרכזית
   - אחרת, ניתן ליצור שלבים לפי קטגוריות המשימות או שלב ברירת מחדל

4. **הפעלה אוטומטית**:
   - הפתרון כולל טריגר שיופעל אוטומטית בעת יצירת פרויקט חדש

## כיצד להעביר משימות נבחרות?

בעת יצירת פרויקט חדש בממשק המשתמש:

1. הצג למשתמש רשימת משימות לבחירה (צ'קבוקסים)
2. שמור את רשימת המזהים של המשימות שנבחרו
3. העבר את המזהים לפונקציה `init_project_tables_and_data` כמערך משימות

דוגמה לקריאה ישירה:

```sql
SELECT init_project_tables_and_data(
  '12345678-1234-1234-1234-123456789abc', -- מזהה הפרויקט
  true, -- יצירת שלבים
  true, -- יצירת משימות ברירת מחדל אם אין משימות נבחרות
  ARRAY['11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222'] -- מערך משימות נבחרות
);
```

או לחלופין, בצד הלקוח:

```javascript
// דוגמה לקריאה ב-JavaScript עם Supabase
const { data, error } = await supabase.rpc('init_project_tables_and_data', {
  project_id_param: '12345678-1234-1234-1234-123456789abc',
  create_default_stages: true,
  create_default_tasks: true,
  selected_task_ids: ['11111111-1111-1111-1111-111111111111', '22222222-2222-2222-2222-222222222222']
});
``` 